<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: brightlink-gesture.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: brightlink-gesture.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * BrightLink Gesture library
 * Usage:
 * Include in HTML before actual script file 
 * &lt;script src="brightlink-gesture.js">&lt;/script>
 * In your UI have a button that will start gesture. A button is needed for requesting iOS permission as permission is requested on user action and not automatically
 * Hence you can have following function change on&lt;event> logic to send appropriate UDP commands
 * &lt;pre>&lt;code>
 * function getPermission() {
	GESTURE.getGesturePermission().then((status)=>{
		if(status==GESTURE.permissionStatus.GRANTED){
			GESTURE.onFlickLeftEvent = ()=>{
				alert("flick left event");
			};
			GESTURE.onFlickRightEvent = ()=>{
				alert("flick right event");
			};
			GESTURE.onPitchEvent = ()=>{
				alert("pitch event");
			};
			GESTURE.onMobileActive = ()=>{
				alert("lift event");
			};
			GESTURE.onMobileInActive = ()=>{
				alert("mobile in active")
			}
		}
	});
}
&lt;/code>&lt;/pre>
 */
class brightlink_gesture {
    /**
     * Initializing variables
     * @param {number} idleActivityTime - time in milliseconds to wait before deciding mobile is inactive.
     * @param {number} minActiveAcceleration - minimum acceleration with gravity to determine mobile is active.
     * @param {number} minActionAcceleration - minimum acceleration with gravity to determine mobile movement event like flip, pitch.
     */
    constructor() {
        this.idleActivityTime = 20000;
        this.minActiveAcceleration = 2;
        this.minActionAcceleration = 15;
        this.permissionStatus = {GRANTED:'granted',DENIED:'denied'};
        this.mobileInActive = false;
        this.firstRegister = true;
        this.inactiveTimer = null;
        window.ondevicemotion = null;
        window.ondeviceorientation = null;
    }
    /**
     * Public function to get permission for motion events.
     * This function is entry point to library and should be called after script is initialized.
     * If iOS will ask to grant permission
     * If Android will directly resolve without asking for permission
     * @return {Promise} This promise will be resolved when permission is either granted or rejected. Permission will resolve with value 'granted' or 'denied' that can be used with enum GESTURE.permissionStatus.GRANTED or GESTURE.permissionStatus.DENIED.
     */
    getGesturePermission(cb) {
        this.firstRegister = true;
        window.ondevicemotion = null;
        window.ondeviceorientation = null;
        let permissionPromise = new Promise((resolve) => {
            if ((/iPad|iPhone|iPod/.test(navigator.userAgent)) &amp;&amp; DeviceMotionEvent.requestPermission) {
                this.requestDeviceMotionIOS(resolve, cb);
            } else {
                this.onGestureEvent(cb);
                this.activateMotionEvents(resolve);
            }
        });
        return permissionPromise;
    }
    /**
     * Private function to get iOS permission from user for device motion event and resolve promise accordingly.
     * @param {object} resolve - Permission will resolve with value 'granted' or 'denied'.
     */
    requestDeviceMotionIOS(resolve) {
        if (typeof (DeviceOrientationEvent).requestPermission === 'function') {
            (DeviceOrientationEvent).requestPermission()
                .then(permissionState => {
                    if (permissionState === this.permissionStatus.GRANTED) {
                        this.onGestureEvent();
                        this.activateMotionEvents(resolve);
                    } else {
                        resolve(this.permissionStatus.DENIED);
                    }
                })
        } else {
            this.activateMotionEvents(resolve);
        }
    }
    /**
     * Private function
     * Will reset timer to check mobile is active or inactive and accordingly resolve granted permission this handler is called only on positive case of granted permission.
     * @param {object} resolve - Permission will resolve with value 'granted'.
     */
    activateMotionEvents(resolve){
        this.resetInactiveTimer();
        resolve(this.permissionStatus.GRANTED);
    }
    /**
     * Private function
     * Raise an event when there is a acceleration with gravity greater than minActionAcceleration
     * onFlickLeftEvent assign a function to this property and this function will be involed when mobile is flipped left (previous slide).
     * onFlickRightEvent assign a function to this property and this function will be involed when mobile is flipped right (next slide).
     * onPitchEvent assign a function to this property and this function will be involed when mobile is pitch down (enter command).
     * @param {object} currentX - Acceleration with gravity on X axis.
     * @param {object} currentZ - Acceleration with gravity on Z axis.
     */
    raiseEvent(currentX, currentZ) {
        if (currentX > this.minActionAcceleration) {
            this.onFlickLeftEvent &amp;&amp; this.onFlickLeftEvent();
        } else if (currentX &lt; -this.minActionAcceleration) {
            this.onFlickRightEvent &amp;&amp; this.onFlickRightEvent();
        } else if (currentZ > this.minActionAcceleration) {
            this.onPitchEvent &amp;&amp; this.onPitchEvent();
        }
    }
    /**
     * Private function
     * This function checks if device is active or inactive
     * If device is inactive and there is some motion detected using minActiveAcceleration value comparison onMobileActive function will be called
     * onMobileActive assign a function to this property and this function will be involed when mobile is comes active (lift event)
     * @param {object} currentX - Acceleration with gravity on X axis.
     * @param {object} currentY - Acceleration with gravity on Y axis.
     * @param {object} currentZ - Acceleration with gravity on Z axis.
     */
    checkIfDeviceActive(currentX, currentY, currentZ) {
        if (currentX > this.minActiveAcceleration || currentY > this.minActiveAcceleration || currentZ > this.minActiveAcceleration){
            if(this.mobileInActive){
                this.onMobileActive &amp;&amp; this.onMobileActive();
                this.mobileInActive = false;
            }
            this.resetInactiveTimer();
        }
    }
    /**
     * Private function
     * Clean timer and restart timer
     */
    resetInactiveTimer(){
        if(this.inactiveTimer){
            clearTimeout(this.inactiveTimer);
        }
        this.inactiveTimer = setTimeout(()=>{
            clearTimeout(this.inactiveTimer);
            this.mobileInActive = true;
            this.onMobileInActive &amp;&amp; this.onMobileInActive();
        },this.idleActivityTime);
    }
    /**
     * Private function
     * When a mobile is moved this event will be take care to handle device motion and detect appropriate event
     */
    onGestureEvent() {
        if (window.DeviceMotionEvent != undefined &amp;&amp; this.firstRegister) {
            this.firstRegister = false;
            window.ondevicemotion = (e) => {
                var currentX = Math.round(e.accelerationIncludingGravity.x),
                    currentY = Math.round(e.accelerationIncludingGravity.y),
                    currentZ = Math.round(e.accelerationIncludingGravity.z);
                this.raiseEvent(currentX, currentZ);
                this.checkIfDeviceActive(currentX, currentY, currentZ);
            }
        }
    }
};
window.GESTURE = new brightlink_gesture();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="brightlink_gesture.html">brightlink_gesture</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Fri Jun 19 2020 15:51:39 GMT+0530 (India Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
